{"version":3,"file":"ServiceState.js","sourceRoot":"","sources":["../../src/socket/ServiceState.ts"],"names":[],"mappings":";;;;;AAEA,4CAAwC;AAExC,sEAA8C;AAE9C,MAAqB,mBAAmB;IAC/B,MAAM,CAAC,MAAM,CAClB,OAAmB,EACnB,OAAkB,EAClB,MAA0B;QAE1B,MAAM,MAAM,GAAG,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,YAAY;aAC7C,KAAqC,CAAC;QACzC,IAAI,MAAM,CAAC,MAAM,KAAK,MAAM;YAAE,OAAO;QAErC,MAAM,CAAC,MAAM,GAAG,MAAM,CAAC;QAEvB,IAAI,MAAM,KAAK,SAAS,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC;YAC5D,qBAAW,CAAC,QAAQ,CAAC,OAAO,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;QAC9C,CAAC;aAAM,IAAI,MAAM,KAAK,SAAS,IAAI,MAAM,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC;YAClE,qBAAW,CAAC,QAAQ,CAAC,OAAO,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;QAC/C,CAAC;QAED,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,oBAAQ,CAAC,aAAa,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAC;QAChE,IAAI,MAAM,KAAK,WAAW,EAAE,CAAC;YAC3B,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,MAAM,CAAC,UAAU,+BAA+B,CAAC,CAAC;YAC1E,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;QACjC,CAAC;IACH,CAAC;CACF;AAxBD,sCAwBC","sourcesContent":["import type { FarmingSim25Server } from '../servers/interfaces';\r\nimport type { WSMessage } from './interfaces';\r\nimport { RCEEvent } from '../constants';\r\nimport type RCEManager from '../Manager';\r\nimport ServerUtils from '../util/ServerUtils';\r\n\r\nexport default class ServiceStateHandler {\r\n  public static handle(\r\n    manager: RCEManager,\r\n    message: WSMessage,\r\n    server: FarmingSim25Server\r\n  ) {\r\n    const status = message.payload.data.serviceState\r\n      .state as FarmingSim25Server['status'];\r\n    if (server.status === status) return;\r\n\r\n    server.status = status;\r\n\r\n    if (status === 'RUNNING' && !server.flags.includes('READY')) {\r\n      ServerUtils.setReady(manager, server, true);\r\n    } else if (status === 'STOPPED' && server.flags.includes('READY')) {\r\n      ServerUtils.setReady(manager, server, false);\r\n    }\r\n\r\n    manager.events.emit(RCEEvent.ServiceStatus, { server, status });\r\n    if (status === 'SUSPENDED') {\r\n      manager.logger.warn(`[${server.identifier}] Server Suspended - Removing`);\r\n      manager.servers.remove(server);\r\n    }\r\n  }\r\n}\r\n"]}